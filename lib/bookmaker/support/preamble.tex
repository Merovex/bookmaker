\ifdefined\isdraft
  % pdflatex "\def\isdraft{1} \input{Bellicose/bellicose.tex}"
  \input{config/tex/draft.sty}
\fi

\makepagestyle{ebook}
\makeoddhead{ebook}{}{\normalfont{\textsf\theauthor}}{\normalfont\thepage}
\makeevenhead{ebook}{\normalfont\thepage}{\normalfont{\textsf\thetitle}}{}

\ifdefined\isepub
  \usepackage{libertine}
  \usepackage[defaultmono]{droidmono}
  \usepackage[T1]{fontenc}
\else
  \usepackage{fontspec}
  \usepackage{xunicode}
  \usepackage{xltxtra}
  \defaultfontfeatures{Mapping=tex-text}
  % \setmainfont{Gentium Basic}
  \setmainfont{Liberation Serif}
  \setsansfont{TitilliumText22L Light}
  \setmonofont{Liberation Mono}
  \newfontinstance\scshape[Letters=SmallCaps, Numbers=Uppercase]{Liberation Mono}
\fi

\usepackage{verbatim}
\usepackage[colorlinks=false]{hyperref}
% \usepackage[utf8x]{inputenc}
\usepackage{
  fancyvrb,
  graphics,
  url,
  rotating,
  lipsum,
  microtype,
  fancybox,
  glossaries,
  titling
}

\ifdefined\disableligature
  \DisableLigatures[f]{encoding = *, family = * }
\fi
\newif\ifhtmloutput\htmloutputfalse
\newif\ifmobioutput\mobioutputfalse

\newcommand{\onlyfinal}[1]{\ifdefined\isfinal{#1}\fi}
\newcommand{\notfinal}[1]{\ifdefined\isfinal\else{#1}\fi}
\newcommand{\whenfinal}[2]{
  \ifdefined\isfinal
    #1
    \else
    #2
  \fi}

%%%%%%%
% Novel Page Style
\whenfinal%
  {\newcommand{\todo}{}}
  {
    \usepackage{todonotes}
    \makeindex
    \makeglossaries
  }

%%%%
% Document Headings

%% Chapter
\setsecheadstyle{\bfseries\large\centering}
\newcounter{renewsection}
\newcommand{\Chapter}[1]{
  \setcounter{renewsection}{\value{section}}
  \chapter{#1}
  \setcounter{section}{\value{renewsection}}
}

%% Section
\renewcommand{\thesection}{\arabic{section}.}

%%%%%%%
% TEXT LAYOUT
\newlength{\AfterFancyBreakMin}
\setlength{\AfterFancyBreakMin}{3\baselineskip}

\setlength{\parindent}{1.5 em}

\makeatletter
\g@addto@macro\quote{\linespread{1}\small{}}
\g@addto@macro\quotation{\linespread{1}\small{}}
\g@addto@macro\caption{\linespread{1}\footnotesize{}}
\makeatother
\tolerance 1414
\hbadness 1414
\setlength{\emergencystretch}{3em}
\righthyphenmin 62
\emergencystretch 1.5em
\hfuzz 0.3pt
\widowpenalty=10000
\clubpenalty=10000

\setlength{\parindent}{1.5 em}

\def\thinspace{\kern .16667em }
\newcommand{\Dash}{\thinspace---\thinspace}
\newcommand{\dash}{\tk{--Wrong Dash--}}

%%%%%%%
% Indices
\let\oldindex\index
\renewcommand{\index}[1]{\oldindex{#1}\marked{#1}}
\newcommand{\Index}[2]{\oldindex{#1}\marked{#2}}
\newcommand{\orbital}[1]{\oldindex{Orbital!#1}\marked{#1}}
\newcommand{\equipment}[1]{\oldindex{Equipment!#1}\marked{#1}}
\newcommand{\system}[1]{\oldindex{System!#1}\marked{#1}}
\newcommand{\character}[1]{\oldindex{Character!#1}\marked{#1}}
\newcommand{\Character}[2]{\oldindex{Character!#1}\marked{#2}}
\newcommand{\ship}[1]{\oldindex{Ship!#1}\marked{\emph{#1}}}
\newcommand{\Ship}[1]{\oldindex{Ship!#1}\marked{\emph{#1}}}
\newcommand{\location}[1]{\oldindex{Location!#1}\marked{#1}}
\newcommand{\Location}[2]{\oldindex{Location!#1}\marked{#2}}
\newcommand{\clin}[1]{\oldindex{Clin!#1}Clin \marked{#1}}

\newcommand{\tidbit}[2]{%
  \newglossaryentry{#1}{%
    name=#1,
    description=#2
  }%
  \marked{\gls{#1}}
}%
\newcommand{\Tidbit}[2]{%
  \newglossaryentry{#1}{%
    name={#1},
    description={#2}
  }%
  #2
}%
\newcommand{\TIDBIT}[2]{%
  \newglossaryentry{#1}{%
    name={#1},
    description={#2}
  }%
  \marked{\gls{#1}} #2
}%

%%%%%%%
% Dates
\usepackage{datetime}
\newdateformat{yearonly}{\THEYEAR}
\newdateformat{usmonthyear}{\monthname[\THEMONTH], \THEYEAR}
\newcommand{\monthyear}{%
  \ifcase\month\or January\or February\or March\or April\or May\or June\or
  July\or August\or September\or October\or November\or
  December\fi\space\number\year
}

%%%%%%%%
% Scene Formatting.
%\newcommand{\scene}[1]{\input{#1}\pbreak}
\newcommand{\thought}[1]{\emph{#1}}
\newcommand{\thtdia}[1]{\emph{`#1'}} 
\newcommand{\ellip}{\ldots}
% \newcommand{\email}[1]{{\vspace*{0.0625in}\parindent{1in}\fontfamily{droidmono}\selectfont\texttt{#1}}}
\newcommand{\email}[1]{\texttt{#1}}
\newcommand{\status}[1]{\notfinal{\textbf{Status:} #1\newline}}
\newcommand{\synopsis}[1]{\notfinal{\line(1,0){320}\newline\textbf{What's going on here?} #1\newline
\line(1,0){320}\newline}}
\newcommand{\slug}[1]{\notfinal{\MakeUppercase{#1}\newline\newline}}
\newcommand{\slugline}[2]{\notfinal{\section{#1}}\onlyfinal{\section{}}\slug{#2}}
\newcommand{\interlude}[1]{\plainfancybreak{\AfterFancyBreakMin}{1}{#1}}

\newcommand{\scene}[3]{%
  \notfinal{\section{#1}\slug{#2}}
  \input{#3}
  \pbreak
}%

\whenfinal%
  {\newcommand{\pbreak}{\pfbreak}}%
  {\newcommand{\pbreak}{\begin{center} \# \# \# \end{center}}}

%%%%%%%%
% Draft Formatting
\setlength\abovedisplayskip{0pt}
\newenvironment{boxed}[1]
  {\begin{Sbox}\begin{minipage}{#1}}
  {\end{minipage}\end{Sbox}\begin{center}\ovalbox{\TheSbox}\end{center}}
  
\newenvironment{droid}{
  \hangindent=1in
  \begin{minipage}{\fontfamily{droidmono}\fontsize{9pt}{9pt}\selectfont \texttt}
}{%
\end{minipage}
  \vspace*{0.0625in}
}

\newcommand{\Framed}[1]{%
  \begin{boxed}{\linewidth}
    #1
  \end{boxed}
}
\newcommand{\tk}[1]{%
  \ifdefined\isdraft%
      % \textbf{TK-#1}
      \todo{#1}\textbf{TK-#1}%
    \else%
      \textbf{TK-#1}%
      % \todo{#1}\textbf{TK-#1}
  \fi%
}%
\newcommand{\TK}[1]{\tk{BAD-TK--#1}}
\newcommand{\marked}[1]{%
  \ifdefined\isfinal%
    #1%
    \else%
      \underline{#1}%
  \fi%
}


\newcommand{\fftitle}[2]{\begin{center} \textbf{#1} \\ \emph{#2} \end{center}} %this is how I get a title in format of bolded line above an italics line, centered.
\newenvironment{dedication}{%
   \cleardoublepage
   \thispagestyle{empty}
   \vspace*{\stretch{1}}
   \hfill\begin{minipage}[t]{0.66\textwidth}
   \raggedright
}%
{
   \end{minipage}
   \vspace*{\stretch{3}}
   \clearpage
}


%%%%
% HTML Formatting
\let\oldnewpage\newpage
\renewcommand{\newpage}{%
  \ifHtml%
    \HCode{<mbp:pagebreak/>}
  \fi%
\oldnewpage
}
